<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>13.1 HTML5 APIs | MAD9014</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Cross-Platform Web Development">
    
    <link rel="preload" href="/W2024/assets/css/0.styles.45320be6.css" as="style"><link rel="preload" href="/W2024/assets/js/app.66be6d0a.js" as="script"><link rel="preload" href="/W2024/assets/js/2.2dde8ef8.js" as="script"><link rel="preload" href="/W2024/assets/js/1.5dccc02f.js" as="script"><link rel="preload" href="/W2024/assets/js/43.ddf9517f.js" as="script"><link rel="preload" href="/W2024/assets/js/21.a0811bd6.js" as="script"><link rel="preload" href="/W2024/assets/js/23.6f106e0b.js" as="script"><link rel="prefetch" href="/W2024/assets/js/10.1a94ffdf.js"><link rel="prefetch" href="/W2024/assets/js/11.444a63bc.js"><link rel="prefetch" href="/W2024/assets/js/12.dfc01b57.js"><link rel="prefetch" href="/W2024/assets/js/13.dac8e333.js"><link rel="prefetch" href="/W2024/assets/js/14.4f6e8388.js"><link rel="prefetch" href="/W2024/assets/js/15.f5bf1111.js"><link rel="prefetch" href="/W2024/assets/js/16.6a92d24e.js"><link rel="prefetch" href="/W2024/assets/js/17.9e61cdfb.js"><link rel="prefetch" href="/W2024/assets/js/18.87da4873.js"><link rel="prefetch" href="/W2024/assets/js/19.1c58f94e.js"><link rel="prefetch" href="/W2024/assets/js/20.6c52a85d.js"><link rel="prefetch" href="/W2024/assets/js/22.46ecc00a.js"><link rel="prefetch" href="/W2024/assets/js/24.37afaa69.js"><link rel="prefetch" href="/W2024/assets/js/25.52cfe7fa.js"><link rel="prefetch" href="/W2024/assets/js/26.df771b4b.js"><link rel="prefetch" href="/W2024/assets/js/27.173d5de9.js"><link rel="prefetch" href="/W2024/assets/js/28.06e857bb.js"><link rel="prefetch" href="/W2024/assets/js/29.0834c8d2.js"><link rel="prefetch" href="/W2024/assets/js/3.3a3f47d0.js"><link rel="prefetch" href="/W2024/assets/js/30.3d8107be.js"><link rel="prefetch" href="/W2024/assets/js/31.d219f188.js"><link rel="prefetch" href="/W2024/assets/js/32.eca59acd.js"><link rel="prefetch" href="/W2024/assets/js/33.721adc44.js"><link rel="prefetch" href="/W2024/assets/js/34.ff0df110.js"><link rel="prefetch" href="/W2024/assets/js/35.7a0d58a0.js"><link rel="prefetch" href="/W2024/assets/js/36.4035590c.js"><link rel="prefetch" href="/W2024/assets/js/37.ade24e63.js"><link rel="prefetch" href="/W2024/assets/js/38.fdd2fbf1.js"><link rel="prefetch" href="/W2024/assets/js/39.0af27504.js"><link rel="prefetch" href="/W2024/assets/js/4.b85af2cd.js"><link rel="prefetch" href="/W2024/assets/js/40.bf654ac6.js"><link rel="prefetch" href="/W2024/assets/js/41.9fb7dc69.js"><link rel="prefetch" href="/W2024/assets/js/42.10b4b851.js"><link rel="prefetch" href="/W2024/assets/js/44.c4cffa3b.js"><link rel="prefetch" href="/W2024/assets/js/45.2467b08e.js"><link rel="prefetch" href="/W2024/assets/js/46.59baae9f.js"><link rel="prefetch" href="/W2024/assets/js/47.aea6a80d.js"><link rel="prefetch" href="/W2024/assets/js/48.4f184429.js"><link rel="prefetch" href="/W2024/assets/js/49.ee4c566b.js"><link rel="prefetch" href="/W2024/assets/js/5.ea05b443.js"><link rel="prefetch" href="/W2024/assets/js/50.a416c609.js"><link rel="prefetch" href="/W2024/assets/js/51.970a1c48.js"><link rel="prefetch" href="/W2024/assets/js/52.fd423478.js"><link rel="prefetch" href="/W2024/assets/js/53.f304801c.js"><link rel="prefetch" href="/W2024/assets/js/54.65c615e2.js"><link rel="prefetch" href="/W2024/assets/js/55.0c7bdb4b.js"><link rel="prefetch" href="/W2024/assets/js/56.c09c6314.js"><link rel="prefetch" href="/W2024/assets/js/57.bd1f28af.js"><link rel="prefetch" href="/W2024/assets/js/58.1906c7ed.js"><link rel="prefetch" href="/W2024/assets/js/59.d527f78b.js"><link rel="prefetch" href="/W2024/assets/js/6.0f9407d8.js"><link rel="prefetch" href="/W2024/assets/js/60.73e7147c.js"><link rel="prefetch" href="/W2024/assets/js/61.18eecfc4.js"><link rel="prefetch" href="/W2024/assets/js/62.78b8aad3.js"><link rel="prefetch" href="/W2024/assets/js/63.8711c3d9.js"><link rel="prefetch" href="/W2024/assets/js/64.32bc00ab.js"><link rel="prefetch" href="/W2024/assets/js/7.58d95412.js"><link rel="prefetch" href="/W2024/assets/js/vendors~docsearch.9e606068.js">
    <link rel="stylesheet" href="/W2024/assets/css/0.styles.45320be6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2024/" class="home-link router-link-active"><img src="/W2024/mad-d-logo-sm.png" alt="MAD9014" class="logo"> <span class="site-name can-hide">MAD9014</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2024/conventions/" class="nav-link">
  Conventions
</a></div><div class="nav-item"><a href="/W2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2024/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2024/conventions/" class="nav-link">
  Conventions
</a></div><div class="nav-item"><a href="/W2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Core JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Browser JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2024/modules/browser-js/week5/dom-1/" class="sidebar-link">5.1: Document Object Model</a></li><li><a href="/W2024/modules/browser-js/week5/dom-2/" class="sidebar-link">5.2: Document Object Model</a></li><li><a href="/W2024/modules/browser-js/week6/events/" class="sidebar-link">6.1: Handling Events</a></li><li><a href="/W2024/modules/browser-js/week7/project-structure/" class="sidebar-link">7.1: Project Structure</a></li><li><a href="/W2024/modules/browser-js/week7/code-structure/" class="sidebar-link">7.2: Code Structure</a></li><li><a href="/W2024/modules/browser-js/week9/promises/" class="sidebar-link">9.1: Promises</a></li><li><a href="/W2024/modules/browser-js/week9/async/" class="sidebar-link">9.2: Asynchronous Programming</a></li><li><a href="/W2024/modules/browser-js/week10/ajax/" class="sidebar-link">10.1: AJAX and Fetch</a></li><li><a href="/W2024/modules/browser-js/week10/fetch-apis/" class="sidebar-link">10.2: Fetch and APIs</a></li><li><a href="/W2024/modules/browser-js/week11/fetch-data/" class="sidebar-link">11.1: Dynamic Data</a></li><li><a href="/W2024/modules/browser-js/week11/security/" class="sidebar-link">11.2: Fetch Security</a></li><li><a href="/W2024/modules/browser-js/week12/observers/" class="sidebar-link">12.1: Observers &amp; Classes</a></li><li><a href="/W2024/modules/browser-js/week12/destructure/" class="sidebar-link">12.2: Destructuring, Spead, &amp; Enumeration</a></li><li><a href="/W2024/modules/browser-js/week13/storage/" aria-current="page" class="active sidebar-link">13.1: HTML5 APIs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#web-storage-api" class="sidebar-link">Web Storage API</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#single-source-of-truth" class="sidebar-link">Single Source of Truth</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#geolocation" class="sidebar-link">Geolocation</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#cache-api" class="sidebar-link">Cache API</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#history-api" class="sidebar-link">History API</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#more-html5-apis" class="sidebar-link">More HTML5 APIs</a></li><li class="sidebar-sub-header"><a href="/W2024/modules/browser-js/week13/storage/#what-to-do-this-week" class="sidebar-link">What to do this week</a></li></ul></li><li><a href="/W2024/modules/browser-js/week13/multi-page/" class="sidebar-link">13.2: Multi-Page, SPA, and JAMStack </a></li><li><a href="/W2024/modules/browser-js/week14/project-1/" class="sidebar-link">14.1: Forms &amp; Page Transitions</a></li><li><a href="/W2024/modules/browser-js/week14/project-2/" class="sidebar-link">14.2: Final Project</a></li><li><a href="/W2024/modules/browser-js/week15/" class="sidebar-link">15.1: Final Project</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hybrid Content</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><header><div class="section-title blue">
    Web Apps
  </div> <h1>13.1 HTML5 APIs</h1></header> <h2 id="web-storage-api"><a href="#web-storage-api" class="header-anchor">#</a> Web Storage API</h2> <p>The Web Storage API has two parts - <code>localStorage</code> and <code>sessionStorage</code>. They have the same methods and properties and work the exact same way. The only difference is that the <code>sessionStorage</code> values
are automatically deleted at the end of the user's session. This means when they close the browser or the tab that contained the current domain as part of the tab's current history.</p> <p>From this point on I will be referring to <code>localStorage</code> only but everything also applies to <code>sessionStorage</code>. Both are a global property accessible from the <code>window</code> object in the browser. They do
not exist in NodeJS.</p> <p>All the data stored in <code>localStorage</code> gets stored as a <code>JSON</code> string.</p> <p>This means that only information that is capable of being a JSON string can be saved in <code>localStorage</code>. No functions, no DOM elements, can be stored in <code>localStorage</code>.</p> <p>We will need to use the built-in <code>JSON</code> methods to convert the data back and forth between a string and an object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'The Big Bang Theory'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">seasons</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
  <span class="token literal-property property">firstSeasonYear</span><span class="token operator">:</span> <span class="token number">2007</span><span class="token punctuation">,</span>
  <span class="token literal-property property">stillPlaying</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//convert the object into a JSON string.</span>
<span class="token keyword">let</span> stringData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//convert the string back into an object</span>
<span class="token keyword">let</span> objectCopy <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stringData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>If you ever need to make a deep copy of an object, this is one way of doing it.</p> <p>If the data that you want to convert to JSON is already a just a string, then you should not use the <code>JSON.stringify()</code> method as it will add an extra set of quotation marks.</p> <div class="custom-block tip"><p class="custom-block-title">Remember</p> <p>It is important to remember that we have no way of editing the strings inside of <code>localStorage</code>. All we can ever do is replace the string with a new one.</p></div> <p>Every time we read or write a value from <code>localStorage</code> we need to use a unique key. The key will be the unique name for that chunk of data. All keys need to be String values. An example key that you
could use for an assignment would be <code>abcd0001-com.example-userscores</code>. It has a username, a domain name, and a descriptive term for what the data is.</p> <div class="custom-block warning"><p class="custom-block-title">Unique Key Names</p> <p>Remember to keep your <code>localStorage</code> key names unique. You don't want to overwrite other data being saved in localStorage or have your data overwritten. Use a name that includes a reference to the
domain, the web application, and even your own development team, plus the purpose of the data.</p></div> <h3 id="localstorage-methods"><a href="#localstorage-methods" class="header-anchor">#</a> LocalStorage Methods</h3> <p>The methods that we have for <code>localStorage</code> are: <code>getItem</code>, <code>setItem</code>, <code>removeItem</code>, <code>clear</code>, <code>key</code> and the property <code>length</code>.</p> <p>The <code>length</code> property will tell you how many items have been saved in <code>localStorage</code> for the current domain. You can create as many different keys as you want for your domain. Each key will have its
own set of data.</p> <blockquote><p>JavaScript files use the Domain of the HTML page that loaded them as the domain context for things like cookies and localStorage.</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//my global variable to hold the data, with default value.</span>
<span class="token keyword">let</span> storage <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'abcd0001-com.example-userscores'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//if there is no key matching this then we will get undefined as the value.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>storage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//we got some data. Use JSON.parse to turn the string into an object</span>
  myData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">//nothing matched. No data under that key yet.</span>
  <span class="token comment">//Setting a default value is a good idea.</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'abcd0001-com.example-userscores'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>myData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//don't forget the JSON.stringify() part.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>To remove a key and its value we would use the <code>removeItem</code> method. It needs the key.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'abcd0001-com.example-userscores'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To remove ALL keys and values for the current domain, use the <code>clear</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you think that there may be lots of possible keys for the current domain and you want to search through them, you can use the <code>key</code> method in conjunction with the <code>length</code> property and a loop.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> len <span class="token operator">=</span> localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is the name of the </span><span class="token template-punctuation string">`</span></span>$<span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">th key.</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noopener noreferrer">MDN Reference for LocalStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage" target="_blank" rel="noopener noreferrer">MDN Reference for SessionStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API" target="_blank" rel="noopener noreferrer">MDN guide to WebStorage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="session-storage"><a href="#session-storage" class="header-anchor">#</a> Session Storage</h3> <p>Session Storage has the exact same methods and properties and abilities as <code>localStorage</code>. The difference is that when the browser tab is closed or the browser is shut down then all the stored data is
marked for deletion.</p> <p>When it comes to the methods in <code>sessionStorage</code>, they are the same as the <code>localStorage</code> ones. Just replace <code>local</code> with <code>session</code> and they will all work.</p> <h3 id="storage-events"><a href="#storage-events" class="header-anchor">#</a> Storage Events</h3> <p>There is actually a storage event that you can listen for to trigger functionality on your page. If you have content on your page that is built based on content coming from Local or Session Storage
you will want to know if that content has changed.</p> <p>For the current window you are looking at you will know if it changes because it can only change if you actually call the <code>localStorage.setItem</code> method.</p> <p>However, it is possible that your user has multiple concurrent windows or tabs open for your website. If the user does something in Tab <code>B</code> then you will want to know in Tab <code>A</code> that the contents of
<code>localStorage</code> have been updated. This is why we have the storage event.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//decide what you want to do WHEN something in local or session storage has been updated.</span>
  ev<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token comment">//the key of the data that was updated</span>
  ev<span class="token punctuation">.</span>oldValue<span class="token punctuation">;</span> <span class="token comment">//the previous value for the key</span>
  ev<span class="token punctuation">.</span>newValue<span class="token punctuation">;</span> <span class="token comment">//the latest value for the key</span>
  ev<span class="token punctuation">.</span>url<span class="token punctuation">;</span> <span class="token comment">//the exact url of the tab/window that changed the storage</span>
  ev<span class="token punctuation">.</span>storageArea<span class="token punctuation">;</span> <span class="token comment">//a Storage object representing the container for the key that was updated.</span>
  <span class="token comment">// this last one is important because it points to Session or Local for the storage</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div title="Storage events across tabs" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/WxnjkZRt3_Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="single-source-of-truth"><a href="#single-source-of-truth" class="header-anchor">#</a> Single Source of Truth</h2> <p>When working with data sources like localStorage and cookies, which are not directly accessible as a variable, we need to create what is known as a <code>single source of truth</code>.</p> <p>It is possible to have multiple functions in multiple scripts that are accessing the values in your cookies or localStorage within the context of the same page load. If one script updates
<code>localStorage</code> then we might not know that the change was made in another function that is sharing that data.</p> <p>To avoid problems caused by this the best approach is to create your own <strong>globally accessible</strong> variable that will hold the data.</p> <p>The <code>cookie</code> and <code>localStorage</code> values are the <strong>CACHED</strong> copy of the data. They only exist to give us context when the app is loaded the next time. We do NOT work from them.</p> <p>When the page first loads, we read the value from the <code>cookie</code> and/or <code>localStorage</code> and put it into the global variable.</p> <p>Any function that needs to access or change the information will make the change to that global variable.</p> <p>Each time the global variable is altered you can call on the <code>document.cookie</code> property or <code>localStorage.setItem</code> method to update the <code>cached</code> value. Remember we are only updating the cache for the
next time the app loads.</p> <p>The only time we ever read from the storage is when the app first loads - using the <code>DOMContentLoaded</code> event as our trigger to fetch the cached data.</p> <h2 id="geolocation"><a href="#geolocation" class="header-anchor">#</a> Geolocation</h2> <p>The <code>Geolocation</code> object in the browser sits inside of the <code>window.navigator</code> object. It has three methods:</p> <ul><li><code>getCurrentPosition</code> A one time call to the current position.</li> <li><code>watchPosition</code> Similar to setInterval, it repeatedly asks for the position.</li> <li><code>clearWatch</code> stops the repeated calls to <code>watchPosition</code>.</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> failCallback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> failCallback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The two functions are the same except that <code>getCurrentPosition</code> runs once and <code>watchPosition</code> runs repeatedly. If you want to stop the <code>watchPosition</code> method running then we call:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">clearWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Both methods accept a success callback function and a failure callback function. The success function will be passed a position object. The failure callback will be passed a position error object. See
the code below for examples.</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Position" target="_blank" rel="noopener noreferrer">MDN Position Object reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PositionError" target="_blank" rel="noopener noreferrer">MDN PositionError Object reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The third parameter is the options object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enableHighAccuracy</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maximumAge</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><iframe src="//codepen.io/mad-d/embed/mymOBy/?height=526&amp;theme-id=0&amp;default-tab=js,result&amp;embed-version=2" width="100%" height="526" allowfullscreen="allowfullscreen" style="width:100%;">.</iframe> <p><strong>click the &quot;edit on codepen&quot; link to open and test the code</strong></p> <p><a href="https://codepen.io/mad-d/pen/mymOBy" target="_blank" rel="noopener noreferrer">Codepen Link<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PositionOptions" target="_blank" rel="noopener noreferrer">MDN options object reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation" target="_blank" rel="noopener noreferrer">MDN Geolocation reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div title="geolocation" class="video-player"><iframe width="560" height="315" src="https://youtube.com/embed/NIAqR34eg7I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="cache-api"><a href="#cache-api" class="header-anchor">#</a> Cache API</h2> <p>Added as part of HTML5, the <code>Cache API</code> lets javascript developers intentionally save files, ( json, css, html, scripts, fonts, images, etc) in the browser to improve performance and reduce latency
for repeated future visits.</p> <p>The <code>Cache API</code> is separate from the built-in browser cache that is controlled by the browser and HTTP Request and Response Headers.</p> <p>When building a cache, the main reason you would want one is to be able to run your website when the network fails or the user turns off their wifi. We want our app to be able to run offline after the
initial load.</p> <p>While the <code>Cache API</code> is primarily used from Service Workers for Progressive Web Apps, we can also use it directly from any webpage.</p> <p>It is based on <a href="https://www.youtube.com/watch?v=SmPouEFKOBg&amp;list=PLyuRouwmQCjngZXVn48vYmPK_1yAF-fLw" target="_blank" rel="noopener noreferrer">Promises<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, just like the <code>Fetch API</code>.</p> <h3 id="cache-method-reference"><a href="#cache-method-reference" class="header-anchor">#</a> Cache Method Reference</h3> <p>There are five main object types that you will be using with when working with the cache.</p> <ul><li>A CacheStorage object called <code>caches</code>, which references all the cache objects for the current origin;</li> <li>A Cache object that you will hold in a variable, which references a single cache;</li> <li>A Request object used as the reference to a single stored file;</li> <li>A Response object that is the container for each file in the cache;</li> <li>A Promise object which holds the result of nearly every cache method.</li></ul> <p>The <code>caches</code> object can be used to get a reference to a single cache, get a list of all the cache names, or let you search for a file across all the caches.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'my-cache-name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//ref is the reference to a single cache called 'my-cache-name'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">names</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//names is an array containing the names of all the origin caches.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'fileurl.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//response is the Response object containing the file with the url 'fileurl.jpg'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The cache reference object is returned by the <code>caches.open</code> method. You have to call the open method to get this reference. Typically you will call this method once and store the reference in a global
variable that can be accessed by other functions.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cacheRef<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//file saved</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//fetch and add a response object to the cache</span>
cacheRef<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>requestArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//all files added</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//fetch an array of urls and add them all to a cache</span>
cacheRef<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//add or replace a response in the cache with the request as the key</span>
cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//found in cache</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//search a single cache for a response with the matching url</span>
cacheRef<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">requests</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//requests is an array of Request objects</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//get a list of requests/urls in the single cache</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="loading-the-cache"><a href="#loading-the-cache" class="header-anchor">#</a> Loading the Cache</h3> <p>When you want to save files in the cache to use later.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> cacheName <span class="token operator">=</span> <span class="token string">'myCache-v1'</span><span class="token punctuation">;</span> <span class="token comment">//key name for our cache</span>
<span class="token keyword">let</span> assets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/img/demo.jpg'</span><span class="token punctuation">,</span> <span class="token string">'/img/other.jpg'</span><span class="token punctuation">,</span> <span class="token string">'/img/joanne.png'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//the array of files to save in our cache</span>

caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//the cache variable is a reference to the cache that you opened.</span>

    <span class="token comment">//these next three .add() calls are all asynchronous.</span>
    <span class="token comment">//normally you would only do one of these calls inside this function.</span>
    <span class="token keyword">let</span> urlString <span class="token operator">=</span> <span class="token string">'/img/1011-800x600.jpg?id=one'</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//cache.add() = fetch() + cache.put()</span>

    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:5500/img/1011-800x600.jpg?id=two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/img/1011-800x600.jpg?id=three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//cache.addAll(assets).then() is an alternative that lets you save an array of urls</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//the open method failed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>In this example we are saving three copies of the same file (an image called <code>1011-800x600.jpg</code>) into our cache. This could have been three different files. This code is just to illustrate that
changing the querystring value makes the browser view it as 3 different files.</p> <p>If you want to have an array of file names you could call the <code>cache.addAll</code> method and pass in the array. The current domain name will be prepended to all those strings when the requests are made,
unless another protocol and domain are used at the start of the string.</p> <p>If you actually did want to call the <code>add()</code> method three times then you would need to put the calls in their own function wrapped in a <code>then()</code> and the <code>cache</code> reference would have to be a variable
accessible to all three functions. <strong>OR</strong> you could just use the <code>addAll()</code> method. <strong>OR</strong> you could make the one <code>then()</code> function into an <code>async</code> function so you could put <code>await</code> infront of each
<code>add()</code> call.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//example using async and await</span>
caches
  <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//adding `async` in front of the function lets us use `await`.</span>

    <span class="token keyword">let</span> urlString <span class="token operator">=</span> <span class="token string">'/img/1011-800x600.jpg?id=one'</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//cache.add() = fetch() + cache.put()</span>

    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:5500/img/1011-800x600.jpg?id=two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'/img/1011-800x600.jpg?id=three'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//the open method failed.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>The <code>cache</code> object also has <code>fetch</code> and <code>put</code> methods. The <code>fetch</code> method will download the file. The <code>put</code> method will save the file in the HTTP Response from the <code>fetch</code> in the cache. The <code>add</code>
method does both the <code>fetch</code> and <code>put</code> steps together.</p> <p>If you ever need to remove something from the cache then you can call the <code>cache.delete()</code> method to remove the file. It takes a <code>Request</code>, <code>URL</code> or <code>USVString</code>, which represent the file, as an
argument. It returns a Promise that resolves when the file has been deleted.</p> <h3 id="reading-the-cache"><a href="#reading-the-cache" class="header-anchor">#</a> Reading the Cache</h3> <p>When you want to read a file from the cache then we use the <code>cache.match()</code> method. It will return a <code>Response</code> object, just like a <code>fetch</code> call would. The difference is that it is looking at the
internal browser cache for your domain under the key used to create the <code>cache</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//the request argument can be a USVString, a URL object, or a Request object</span>
<span class="token comment">//the options argument is optional. It is an object with 3 properties</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">ignoreSearch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ignore the queryString</span>
  <span class="token literal-property property">ignoreMethod</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ignore the method - POST, GET, etc</span>
  <span class="token literal-property property">ignoreVary</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ignore if the response has a VARY header</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
cache
  <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with the response object... just like you would with fetch</span>
    <span class="token comment">// if(! response.ok) throw new Error(response.statusText)</span>
    <span class="token comment">// response.json()</span>
    <span class="token comment">// response.blob()</span>
    <span class="token comment">// response.text()</span>
    <span class="token comment">// response.formData()</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="reading-a-list-of-files-from-the-cache"><a href="#reading-a-list-of-files-from-the-cache" class="header-anchor">#</a> Reading a List of Files from the Cache</h3> <p>Every <code>cache</code> object has an asynchronous method called <code>keys()</code> which will return a Promise that resolves to an array of Request objects. This is the list of all the files stored in the Cache.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//assume that we have this line already called in our code.</span>
<span class="token keyword">const</span> cacheRef <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'MyCacheOfImages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//with that cache Reference we can use keys() to get an array of Responses (Files) in the cache</span>
cacheRef<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//keys is the array of Requests in the Cache.</span>
  keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//output the url of each file in the cache</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The example above outputs the url for each file stored in the cache.</p> <blockquote><p>Remember that every file saved in the Cache is wrapped inside of a Response object. The Requests returned by the keys() method is like a variable name for each Response.</p></blockquote> <p>So, when we get the keys, we now have a url that we can use to retrieve the actual file from the cache.</p> <p>We can now use the <code>cacheRef.match(request)</code> method to retrieve each of the files, one at a time.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cacheRef<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//keys is the array of Requests in the Cache.</span>
  <span class="token keyword">const</span> responses <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//retrieve the response for each request</span>
    <span class="token keyword">return</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//OR cacheRef.match(request.url);</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// !!!! THIS CODE WILL FAIL !!!!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>At first glance, the code above looks like it will do what we want. It loops through the array of keys (request) and calls the <code>match()</code> method to retrieve a file.</p> <p>The PROBLEM is that every <code>match()</code> call returns a Promise. The <code>responses</code> array will be an array of Promises and we cannot use the array until ALL of the promises are resolved.</p> <p>The FIX is to wrap the <code>keys.map()</code> method inside of <code>Promise.all()</code> which will wait until all the promises in the returned array have been resolved. Only then will <code>responses</code> be an array of actual
response objects.</p> <blockquote><p>See week 9 for notes about Promises and the Promise.all method.</p></blockquote> <p>Also, we will put the variable <code>responses</code> into the next <code>then()</code> method and return the result of <code>Promise.all()</code> to that next <code>then()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cacheRef
  <span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//keys is the array of Requests in the Cache.</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
      <span class="token comment">//retrieve the response for each request</span>
      keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">//skip the keyword return by making the arrow function a single line with no {}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">responses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//here we have an array called responses, full of response objects</span>
    <span class="token comment">//each response object contains a file from the cache.</span>
    responses<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//output the path/filename plus type of each files from the cache</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>The first Promise is created by the call to <code>keys()</code>.</p> <p>The next Promise is created by <code>Promise.all()</code>.</p> <p>Inside the <code>Promise.all()</code> method we create an array of Promises by calling the <code>array.map()</code> method on the array of keys/requests and calling <code>cache.match()</code> on each of the requests.</p> <p>You can think of the <code>Promise.all()</code> part like this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'image.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'pic.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'styles.css'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'main.js'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Promise.all converts all the Promises created by each call to <code>match()</code> into a single array wrapped in a single Promise.</p> <h3 id="opening-a-list-of-files-from-the-cache"><a href="#opening-a-list-of-files-from-the-cache" class="header-anchor">#</a> Opening a List of Files from the Cache</h3> <p>So, now we have an array of <code>Response</code> objects created by a series of calls to <code>cache.match()</code> wrapped inside a <code>Promise.all()</code>.</p> <p>If we want all the actual files instead of an Array of Response objects then we will repeat the same approach with <code>Promise.all()</code>, except this time we need to use the <code>Response.blob()</code> or
<code>Response.text()</code>, or <code>Response.json()</code> methods.</p> <p>For simplicities sake, let's pretend that every file in our cache is an image. So, we will use the <code>response.blob()</code> on each Response.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cacheRef
  <span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">responses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>responses<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blobs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//blobs is an array of actual binary image data for each image from the cache</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>The repeated call to <code>reponse.blob()</code> inside the <code>responses.map()</code> will create an array of Blobs (Binary Large OBjects). This is the binary data from each image file from the cache.</p> <p>Now, in actuality, each <code>blob</code> in the <code>blobs</code> array is only a reference pointer to the location in memory where the image data is currently held.</p> <p>If we want to use the <code>blob</code> data on a webpage then we need to turn that memory location into a URL that we can pass to an <code>&lt;img&gt;</code> src attribute. We do this with a <code>URL.createObjectURL()</code> method.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>cacheRef
  <span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cacheRef<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">responses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>responses<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blobs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    blobs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//for each blob location in memory...</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//create a url that points to that memory location</span>
      <span class="token comment">//and then add your images to the webpage as desired.</span>
      <span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      img<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>For your final project you will be using the Cache API to save copies of files fetched from an image API.</p></blockquote> <p>Here are a couple videos talking about how to work with Blobs and Files in the browser. Many of the examples in the videos use the Cache for saving and retrieving the Files.</p> <div title="Files, Blobs, and ArrayBuffers" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ScZZoHj7mqY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="Files, Caches, Canvas, and Blobs" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/zq2xD-xuIG4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h3 id="cache-control-header"><a href="#cache-control-header" class="header-anchor">#</a> Cache-Control Header</h3> <p>The <code>Cache API</code> is not to be confused with the <code>Cache-Control Header</code> that is part of the HTTP Response specification. The
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" target="_blank" rel="noopener noreferrer">Cache-Control Header<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a header that is sent from the server or proxy-server to the client along with a requested file. It
tells the browser how to handle the caching of the requested file and how long it should be considered valid before requesting a new copy of the file.</p> <p>The name of the header is <code>cache-control</code> and it can hold a variety of directives. Here are a few examples of the header showing some of the directives.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cache-Control: max-age=604800
Cache-Control: no-cache
Cache-Control: max-age=604800, must-revalidate
Cache-Control: no-store
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div> <h2 id="history-api"><a href="#history-api" class="header-anchor">#</a> History API</h2> <p>Any time that you are using a browser, the whole reason that you are able to use the back and forward buttons is because of the <code>History API</code>. Your browser maintains an Array of visited pages for each
and every tab.</p> <p>Each entry in the history Array contains the full URL, including the querystring, plus the <code>state</code> data. The <code>state</code> data includes setting values that you created through JavaScript to save in the
history array entry plus form data that was filled out if a form was submitted.</p> <p>The <code>History API</code> encompasses the history Array plus a collection of methods that let you move through that array, events for monitoring navigation and movement through the array, and methods for
updating what is written in the location bar and entries in the history array.</p> <p>The <code>history</code> object is a top level object inside the <code>window</code> object, just like <code>document</code> and <code>navigator</code>. Here are the basic property and methods for <code>history</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>history<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// the number of entries in the history array for the current tab</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// navigate back three steps in the history array</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// navigate back one step</span>
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//navigate forward one step</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>history.state</code> property gives you the value of the current entry's state object.</p> <p>If you want to change the value of <code>state</code>, change or add an entry in the array, and change what is written in the location bar, then we use these two methods:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//both these methods will change what is written in the location bar</span>
<span class="token comment">//replaceState will replace the current history array entry with a new value</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//pushState will add a new entry to the history array. The new value will become the current entry</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//title is ignored in all browsers except Firefox</span>
<span class="token comment">//state is the data object saved in association with the history array entry</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Notice</strong> that I did not say anything about navigating with these methods. They do not actually load anything. They add or change an entry in the history array. They change what is written in the
location bar. They DO NOT navigate or load any page.</p> <p>The events that we can use, in conjunction with the <code>history api</code>, are <code>hashchange</code> and <code>popstate</code>.</p> <p>The <code>hashchange</code> event is fired when the fragment identifier of the URL has changed. The <code>Event</code> object associated with <code>hashchange</code> has an <code>oldURL</code> and a <code>newURL</code> property that you can use as
reference.</p> <p>Note that just calling <code>history.pushState()</code> or <code>history.replaceState()</code> won't trigger a <code>popstate</code> event. The <code>popstate</code> event will be triggered by doing a browser action such as a click on the <code>back</code> or <code>forward</code> button (or calling <code>history.back()</code> or <code>history.forward()</code> in JavaScript).</p> <p>Typing a new hash value in the locationbar will not trigger a <code>popstate</code> event as the page has already loaded and a new hash value just makes the browser try to scroll to a matching id. It will,
however, trigger a <code>hashchange</code> event.</p> <p>A Single Page App (<code>SPA</code>) is the most common reason to use the <code>History API</code>. If you are building a <code>SPA</code> it means that you are building a website with only one HTML file. You use JavaScript to manage
the History array, what is written in the location bar, the fetching and caching of new content, and the display of that content.</p> <p>The general approach is to add click listeners to your anchor tags and when the user clicks them, you use <code>ev.preventDefault()</code> to stop the browser from trying to load the new url. Instead, you can
take the url and, with <code>pushState()</code> you can update the History and the location bar. Then call whatever functions you want to add and remove the appropriate content.</p> <p>If you wanted, you could actually use <code>fetch()</code> to retrieve new HTML files and then display their content. Remember, that the <code>Response</code> object has the <code>text()</code> method as well as the <code>json()</code> method.
You can extract the text from an HTML file and turn it into a HTML String that can be queried just like a normal HTML file.</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./index.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./stores.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Stores<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./products.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navlink<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Products<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>By using <code>href</code> inside anchor tags it means that you could have static versions of those pages or routing set up on the server that would be loaded if JavaScript was disabled.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">APP</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nav <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'nav'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nav<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token constant">APP</span><span class="token punctuation">.</span>handleNav<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handleNav</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//stop browser navigating</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'.navlink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//get the link that was clicked</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//exit function if no anchor was clicked</span>
    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//update history and location bar</span>
    <span class="token comment">//decide what to do next</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//home page...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'stores.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//stores page...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'products.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//products page...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token constant">APP</span><span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>You can also add listeners in the <code>init</code> function for <code>popstate</code> and <code>hashchange</code>. <code>popstate</code> function handles the user clicking the back button or manually typing an address. The <code>hashchange</code>
function handles clicking on other links that only change the hash value in the url or the user manually typing a new hash value in the location bar.</p> <p>The <code>popstate</code> event and the <code>hashchange</code> event will both have their listeners attached to the <code>window</code> object.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> handlePopNav<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> handleHashNav<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="popstate-vs-hashchange-vs-click-vs-load"><a href="#popstate-vs-hashchange-vs-click-vs-load" class="header-anchor">#</a> popstate vs hashchange vs click vs load</h3> <p>When you are trying to build a navigation system for your web app there are many different events that you can listen for. Understanding the difference between what triggers these different events is
key.</p> <p>Here is a list of what actions will trigger these events.</p> <p><strong>popstate</strong></p> <ul><li>moving between entries in the History array.</li> <li>loading a page by typing into the location bar</li> <li>clicking a link that loads a new URL</li></ul> <p><strong>hashchange</strong></p> <ul><li>moving between History array entries where only the hash value has changed.</li> <li>user has clicked on an anchor where href is just a hash value.</li> <li>user types in the location bar and only changes the hash value.</li></ul> <p><strong>click</strong></p> <ul><li>user clicks on an element on the page.</li> <li>this happens before any navigation would occur, so it is a chance to intercept and control the navigation.</li></ul> <p><strong>load</strong> or <strong>DOMContentLoaded</strong></p> <ul><li>moving to a new entry in the History array, as long as the pathname, not just the hash value has changed.</li> <li>initial load of a webpage.</li></ul> <div title="History API - part I" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/Mo9wn8jS1F8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="History API - part II" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/ABllxOcsPsc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <div title="History pushState and replaceState" class="video-player"><iframe width="560" height="315" src="https://www.youtube.com/embed/j1ZHuyhHApg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></div> <h2 id="more-html5-apis"><a href="#more-html5-apis" class="header-anchor">#</a> More HTML5 APIs</h2> <p>At this point you might be saying something like,</p> <blockquote><p>&quot;Holy Crap! That was a lot of code to get familiar with! I hope there aren't many more HTML5 APIs.&quot;</p></blockquote> <p>Well, there are actually ~120 HTML5 Web APIs.</p> <p>If you include the ones discussed on this page though, you have actually already learned <strong>over</strong> 20 of these. Another ~20 are just experimental ones and a few more have been deprecated. At least
another 40 are ones that you are unlikely to need unless you are working on a project that uses a very specific technology like the <code>Payment Request API</code> or <code>Picture-in-Picture API</code> or
<code>MediaStream Recording API</code> or <code>Web Audio API</code> or <code>WebXR Device API</code>.</p> <p>There is a new API coming called <code>Navigation API</code> which is designed to replace the <code>History API</code>.</p> <p>Next semester you will be covering a handful more, and with that, you will have a very good grasp on what web developers need 80% of the time.</p> <p>Here is the <a href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank" rel="noopener noreferrer">list of current Web APIs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on the MDN site with documentation.</p> <h2 id="what-to-do-this-week"><a href="#what-to-do-this-week" class="header-anchor">#</a> What to do this week</h2> <div class="custom-block warning"><p class="custom-block-title">TODO Things to do before next week.</p> <ul><li>Read all the content from <code>Modules 13.1, 13.2, and 14.1</code>.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/26/2024, 8:34:40 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/W2024/modules/browser-js/week12/destructure/" class="prev">
        12.2: Destructuring, Spead, &amp; Enumeration
      </a></span> <span class="next"><a href="/W2024/modules/browser-js/week13/multi-page/">
        13.2: Multi-Page, SPA, and JAMStack 
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/W2024/assets/js/app.66be6d0a.js" defer></script><script src="/W2024/assets/js/2.2dde8ef8.js" defer></script><script src="/W2024/assets/js/1.5dccc02f.js" defer></script><script src="/W2024/assets/js/43.ddf9517f.js" defer></script><script src="/W2024/assets/js/21.a0811bd6.js" defer></script><script src="/W2024/assets/js/23.6f106e0b.js" defer></script>
  </body>
</html>
